# CRM System для Риелторов

## Описание проекта

Это CRM-система для риелторов, разработанная на чистой Java 17+ с использованием архитектуры MVC и ручного Dependency Injection. Проект реализуется поэтапно: от консольной версии с in-memory хранением до веб-приложения с PostgreSQL и Servlet/JSP.

## Архитектура

```
com.company.crm/
├── config/                 # AppConfig / DI контейнер
├── model/                  # Сущности данных
├── dao/
│   ├── interfaces/         # Интерфейсы DAO
│   └── inmemory/           # In-Memory реализации DAO
├── service/
│   ├── interfaces/         # Интерфейсы сервисов
│   └── impl/               # Реализации сервисов
├── controller/             # Консольные контроллеры
├── util/                   # Вспомогательные утилиты
└── Main.java               # Точка входа
```

## Сущности системы

- **Employee** - Сотрудники агентства
- **Client** - Клиенты (покупатели/продавцы)
- **Object** - Объекты недвижимости
- **Photo** - Фотографии объектов
- **AdditionalCondition** - Дополнительные условия сделок
- **Task** - Задачи сотрудников
- **Deal** - Сделки
- **Meeting** - Встречи с клиентами

## Текущий статус

✅ **Этап 1 завершен** - Консольная версия с in-memory хранением

### Реализованные функции:

- ✅ Полная MVC архитектура
- ✅ Ручной Dependency Injection
- ✅ CRUD операции для всех сущностей
- ✅ In-memory реализации DAO
- ✅ Консольный интерфейс управления
- ✅ Валидация данных
- ✅ Тестовые данные при запуске

## Запуск приложения

### Требования:
- Java 17 или выше
- Gradle


## Использование

После запуска откроется главное меню CRM:

```
=== CRM MENU ===
1. Employees
2. Clients
3. Objects
4. Photos
5. Conditions
6. Tasks
7. Deals
8. Meetings
0. Exit
```

### Основные операции для каждой сущности:
- **List** - Просмотр всех записей
- **Create** - Создание новой записи
- **Edit** - Редактирование существующей записи
- **Delete** - Удаление записи

## Особенности реализации

### Архитектурные принципы:
- **Слоистая архитектура** - четкое разделение на Model, DAO, Service, Controller
- **Dependency Injection** - ручная реализация DI через AppConfig
- **Интерфейсы** - все DAO и сервисы работают через интерфейсы
- **SOLID** - соблюдение принципов SOLID

### Паттерны проектирования:
- **MVC** - Model-View-Controller
- **Repository** - для доступа к данным
- **Service Layer** - для бизнес-логики
- **Dependency Injection** - для управления зависимостями

## Следующие этапы разработки

### Этап 2 - JDBC + PostgreSQL
- Подключение PostgreSQL через JDBC
- Реализация DAO для работы с БД
- Миграция данных из памяти в базу

### Этап 3 - Веб-версия
- Реализация Servlet контроллеров
- Создание JSP представлений
- Развертывание на Tomcat

### Этап 4 - Дополнительные функции
- Авторизация и аутентификация
- Пагинация и поиск
- Экспорт данных
- Логирование

## Технические детали

### Используемые технологии:
- **Java 17** - основной язык разработки
- **Gradle** - управление зависимостями и сборка
- **PostgreSQL** (на следующих этапах) - база данных
- **Servlets/JSP** (на следующих этапах) - веб-слой

### Разрешенные библиотеки:
- PostgreSQL JDBC Driver
- Servlet API
- JSTL
- Lombok (опционально)

## Разработчикам

### Структура пакетов:
- `model` - сущности данных (POJO)
- `dao/interfaces` - интерфейсы доступа к данным
- `dao/inmemory` - in-memory реализации DAO
- `service/interfaces` - интерфейсы бизнес-логики
- `service/impl` - реализации сервисов
- `controller` - консольные контроллеры
- `config` - конфигурация DI
- `util` - вспомогательные утилиты

### Добавление новой сущности:
1. Создать класс в `model/`
2. Создать интерфейс DAO в `dao/interfaces/`
3. Реализовать DAO в `dao/inmemory/`
4. Создать интерфейс Service в `service/interfaces/`
5. Реализовать Service в `service/impl/`
6. Создать Controller в `controller/`
7. Зарегистрировать в `AppConfig`

## Git

https://github.com/Andrsn5/CRMForRealtors.git

## Database Tests

## DealService

### ✅ Позитивные тесты:
1. **Создать сделку с null комиссией**
    - Проверяет корректную обработку отсутствующей комиссии
    - Создает сделку с commission = null
    - Убеждается, что сделка сохранена без ошибок

2. **Создать сделку с прошедшей датой**
    - Тестирует создание сделки с датой в прошлом
    - Проверяет, что исторические даты допустимы
    - Убеждается в корректном сохранении в БД

3. **Создать сделку с валидными статусами**
    - Тестирует все допустимые статусы сделок:
        - `active` - активная
        - `sold` - проданная
        - `completed` - завершенная
        - `withdrawn in progress` - отозвана в процессе
        - `cancelled` - отмененная
    - Проверяет корректное сохранение каждого статуса в БД

### ❌ Негативные тесты:
1. **Создать сделку с нулевой суммой**
    - Проверяет ValidationException при dealAmount = 0
    - Убеждается, что сделка не сохраняется в БД

2. **Создать сделку с отрицательной комиссией**
    - Проверяет ValidationException при commission < 0
    - Проверяет ограничения БД на отрицательные значения

3. **Создать сделку с дублирующимся номером**
    - Тестирует уникальность dealNumber в БД
    - Проверяет constraint violation при дубликате

4. **Создать сделку с несуществующей задачей**
    - Проверяет foreign key constraint
    - Тестирует целостность ссылки на task_id

---

## EmployeeService

### ✅ Позитивные тесты:
1. **Создать сотрудника с валидными данными**
    - Проверяет полное сохранение всех полей в БД
    - Тестирует корректность данных после извлечения

2. **Обновить сотрудника, изменяя должность**
    - Проверяет UPDATE операцию в БД
    - Тестирует изменение position field
    - Убеждается в сохранении других неизмененных полей

3. **Поиск всех сотрудников**
    - Тестирует SELECT * FROM employees
    - Проверяет корректность возвращаемого списка
    - Убеждается в целостности данных

4. **Создать сотрудника только с обязательными полями**
    - Проверяет минимальные требования БД
    - Тестирует NOT NULL constraints
    - Убеждается в корректных default values

5. **Создать неактивного сотрудника**
    - Тестирует сохранение boolean поля is_active
    - Проверяет значение false в БД

6. **Создать сотрудников с различными валидными должностями**
    - Тестирует все допустимые позиции:
        - `Analyst`
        - `Assistant`
        - `Real Estate Agent`
        - `Senior Manager`
        - `Sales Manager`
    - Проверяет корректное сохранение в БД

### ❌ Негативные тесты:
1. **Создать сотрудника с дублирующимся email**
    - Проверяет UNIQUE constraint на email
    - Тестирует violation при дубликате

2. **Создать сотрудника без обязательных полей**
    - Проверяет NOT NULL constraints:
        - first_name
        - last_name
        - email
        - position
    - Тестирует откат транзакции

3. **Создать сотрудника с невалидным email**
    - Проверяет email format validation
    - Тестирует constraint violation

---

## MeetingService

### ✅ Позитивные тесты:
1. **Создать встречу с одним клиентом в разное время**
    - Проверяет возможность multiple meetings per client
    - Тестирует временные слоты в БД
    - Убеждается в корректности datetime полей

2. **Создать встречи в одно время с разными клиентами**
    - Тестирует параллельные встречи
    - Проверяет отсутствие конфликтов в БД
    - Убеждается в целостности данных

3. **Создать встречу после отмененной**
    - Проверяет логику статуса "cancelled"
    - Тестирует освобождение временного слота
    - Убеждается в корректности status field

4. **Создать встречу с клиентом и задачей**
    - Проверяет foreign key constraints
    - Тестирует связи client_id и task_id
    - Убеждается в целостности отношений

5. **Создать встречу без задачи (null taskId)**
    - Проверяет optional foreign key
    - Тестирует NULL значения в БД
    - Убеждается в корректной обработке

6. **Создать встречу с прошедшей датой**
    - Тестирует исторические даты встреч
    - Проверяет сохранение past datetime
    - Убеждается в отсутствии временных ограничений

### ❌ Негативные тесты:
1. **Создать встречу без клиента**
    - Проверяет NOT NULL constraint на client_id
    - Тестирует foreign key requirement

2. **Создать встречу с несуществующим клиентом**
    - Проверяет foreign key integrity
    - Тестирует constraint violation

3. **Создать встречу с дублирующим временем для одного клиента**
    - Проверяет бизнес-логику уникальности времени
    - Тестирует временные конфликты

---

## ObjectService

### ✅ Позитивные тесты:
1. **Создать объект со всеми полями**
    - Проверяет полное сохранение объекта в БД
    - Тестирует все поля: title, type, deal_type, price, area, rooms, etc.
    - Убеждается в целостности данных

2. **Создать объект только с обязательными полями**
    - Проверяет минимальные требования БД
    - Тестирует NOT NULL constraints
    - Убеждается в default values

3. **Создать объект с null опциональными числовыми полями**
    - Тестирует NULL значения для:
        - area
        - rooms
        - bathrooms
    - Проверяет корректную обработку в БД

4. **Обновить объект, сменив статус на "Sold"**
    - Проверяет UPDATE операции
    - Тестирует изменение status field
    - Убеждается в сохранении других полей

5. **Поиск объектов разных типов**
    - Тестирует SELECT с фильтрацией по object_type
    - Проверяет типы:
        - `Apartment` - квартира
        - `House` - дом
        - `Commercial` - коммерческая недвижимость
        - `Land` - земельный участок
        - `Villa` - вилла
    - Убеждается в корректности фильтрации

6. **Создать объекты с валидными типами сделок**
    - Тестирует deal_type поля:
        - `Sale` - продажа
        - `Rent` - аренда
    - Проверяет корректное сохранение в БД

7. **Создать объект с минимальной ценой (1000)**
    - Проверяет boundary value для price
    - Тестирует CHECK constraint на минимальную цену
    - Убеждается в корректности валидации

8. **Создать объект с минимальной площадью (1)**
    - Проверяет boundary value для area
    - Тестирует CHECK constraint на минимальную площадь
    - Убеждается в корректности данных

9. **Создать объекты со статусами**
    - Тестирует все допустимые статусы объектов:
        - `Available` - доступен
        - `Sold` - продан
        - `Rented` - сдан в аренду
        - `Under Contract` - по договору
        - `Reserved` - зарезервирован
        - `Draft` - черновик
    - Проверяет корректное сохранение в БД

### ❌ Негативные тесты:
1. **Создать объект с дублирующимся title**
    - Проверяет UNIQUE constraint на title
    - Тестирует violation при дубликате

2. **Создать объект с невалидным object_type**
    - Проверяет CHECK constraint на object_type
    - Тестирует domain validation

3. **Создать объект с отрицательной ценой**
    - Проверяет CHECK constraint на price > 0
    - Тестирует boundary validation

---

## PhotoService

### ✅ Позитивные тесты:
1. **Создать фото с objectId**
    - Проверяет foreign key constraint на object_id
    - Тестирует связь с объектом недвижимости
    - Убеждается в целостности данных

2. **Обновить фото, изменяя caption и displayOrder**
    - Проверяет UPDATE операцию
    - Тестирует изменение caption и display_order полей
    - Убеждается в сохранении изменений

3. **Создать несколько фото для разных объектов**
    - Тестирует multiple photos per object
    - Проверяет целостность object_id связей
    - Убеждается в корректности данных

4. **Создать фото с валидным URL**
    - Проверяет сохранение корректных URL в БД
    - Тестирует photo_url field
    - Убеждается в целостности данных

5. **Создать фото с HTTP URL**
    - Проверяет поддержку HTTP протокола в URL
    - Тестирует различные URL форматы
    - Убеждается в корректности сохранения

6. **Создать фото без подписи**
    - Проверяет NULL значения для caption
    - Тестирует optional поля
    - Убеждается в корректной обработке

7. **Создать фото с максимальным displayOrder (1000)**
    - Проверяет boundary value для display_order
    - Тестирует CHECK constraint на максимальное значение
    - Убеждается в корректности валидации

8. **Создать фото с одинаковым displayOrder для разных объектов**
    - Проверяет уникальность display_order в рамках одного объекта
    - Тестирует composite uniqueness constraint
    - Убеждается в разрешении дубликатов для разных объектов

9. **Обновить фото — переназначить objectId**
    - Проверяет изменение foreign key
    - Тестирует UPDATE object_id
    - Убеждается в целостности новой связи

### ❌ Негативные тесты:
1. **Создать фото без objectId**
    - Проверяет NOT NULL constraint на object_id
    - Тестирует foreign key requirement

2. **Создать фото с несуществующим objectId**
    - Проверяет foreign key integrity
    - Тестирует constraint violation

3. **Создать фото с дублирующим displayOrder для одного объекта**
    - Проверяет UNIQUE constraint на (object_id, display_order)
    - Тестирует composite key violation

---

## TaskService

### ✅ Позитивные тесты:
1. **Создать задачу с будущей датой выполнения**
    - Проверяет сохранение future dates в БД
    - Тестирует due_date field
    - Убеждается в корректности datetime данных

2. **Создать задачу без даты выполнения (null dueDate)**
    - Проверяет NULL значения для due_date
    - Тестирует optional поля
    - Убеждается в корректной обработке

3. **Создать задачу с текущей датой выполнения**
    - Проверяет сохранение current timestamp
    - Тестирует boundary value для due_date
    - Убеждается в корректности данных

4. **Обновить задачу, изменяя приоритет на "High" и статус на "In Progress"**
    - Проверяет UPDATE операцию
    - Тестирует изменение priority и status полей
    - Убеждается в сохранении изменений

5. **Поиск всех задач со смешанными статусами**
    - Тестирует SELECT с различными статусами:
        - `Pending` - ожидает
        - `In Progress` - в процессе
        - `Done` - выполнено
    - Проверяет корректность фильтрации и возврата данных

6. **Создать задачи с валидными приоритетами**
    - Тестирует priority field с значениями:
        - `High` - высокий
        - `Medium` - средний
        - `Low` - низкий
    - Проверяет корректное сохранение в БД

7. **Создать задачу без клиента и объекта (null clientId и objectId)**
    - Проверяет optional foreign keys
    - Тестирует NULL значения для client_id и object_id
    - Убеждается в корректной обработке

### ❌ Негативные тесты:
1. **Создать задачу без ответственного сотрудника**
    - Проверяет NOT NULL constraint на responsible_id
    - Тестирует foreign key requirement

2. **Создать задачу с несуществующим ответственным**
    - Проверяет foreign key integrity на responsible_id
    - Тестирует constraint violation

3. **Создать задачу с невалидным приоритетом**
    - Проверяет CHECK constraint на priority
    - Тестирует domain validation

4. **Создать задачу без названия**
    - Проверяет NOT NULL constraint на title
    - Тестирует обязательные поля

AdditionalConditionServiceTest
✅ Позитивные тесты

    Создание условия с валидными данными

        Проверяет успешное создание условия с флагом обязательности, приоритетом и типом

        Валидирует: isRequired=true, priority="high", conditionType="marketing"

    Создание условия с прошедшим дедлайном

        Проверяет работу с прошедшими датами дедлайна

    Создание условия с дедлайном на сегодня

        Проверяет корректную обработку текущей даты

    Обновление условия - изменение статуса и приоритета

        Тестирует изменение статуса на "completed" и приоритета на "low"

    Создание условия с длинным текстом

        Проверяет обработку длинных описаний (1000 символов) и заметок (2000 символов)

    Удаление условия из системы

        Проверяет полное удаление условия

    Создание условий с валидными типами

        Тестирует все допустимые типы: marketing, administrative, customer service, legal, technical

    Создание условий с валидными статусами

        Тестирует статусы: completed, active, canceled, in progress, paused

    Создание условий с валидными приоритетами

        Тестирует приоритеты: high, medium, low

❌ Негативные тесты

    Создание условия с невалидным типом

        Проверяет ValidationException для недопустимого типа условия

    Создание условия с невалидным статусом

        Проверяет ValidationException для недопустимого статуса

    Создание условия с невалидным приоритетом

        Проверяет ValidationException для недопустимого приоритета

    Создание условия без обязательных полей

        Проверяет ValidationException при отсутствии обязательных полей

ClientServiceTest
✅ Позитивные тесты

    Создание клиента с бюджетом

        Проверяет создание клиента с типом "customer" и бюджетом 150000.00

    Создание клиента с null бюджетом

        Проверяет работу с отсутствующим бюджетом

    Обновление клиента - изменение типа

        Тестирует смену типа клиента с "customer" на "seller"

    Поиск всех клиентов разных типов

        Проверяет возврат всех созданных клиентов

    Создание клиента с нулевым бюджетом

        Проверяет обработку бюджета равного нулю

    Создание клиентов с валидными типами

        Тестирует типы: customer, seller, tenant, landlord

    Создание клиента только с обязательными полями

        Проверяет минимальный набор данных: firstName, lastName, clientType

❌ Негативные тесты

    Создание клиента с отрицательным бюджетом

        Проверяет ValidationException для отрицательного бюджета

    Создание клиента без обязательных полей

        Проверяет ValidationException при отсутствии firstName и lastName

    Создание клиента с невалидным типом

        Проверяет ValidationException для недопустимого типа клиента
